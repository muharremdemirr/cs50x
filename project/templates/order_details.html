{% extends "layout.html" %}

{% block title %}
    Order Details
{% endblock %}

{% block head %}
    <style>
    .status-badge {
        font-weight: 600;
        font-size: 1rem;
        padding: 0.3rem 0.8rem;
        border-radius: 0.5rem;
        display: inline-flex;
        align-items: center;
        gap: 0.4rem;
    }

    .received {
        color: gray !important;
        background-color: #f0f0f0 !important;
    }

    .preparing {
        color: orange !important;
        background-color: #fff4e0 !important;
    }

    .onway {
        color: goldenrod !important;
        background-color: #fff8dc !important;
    }

    .completed {
        color: green !important;
        background-color: #e6ffea !important;
    }

    .canceled {
        color: red !important;
        background-color: #ffe6e6 !important;
        text-decoration: line-through red !important;
    }
    </style>

{% endblock %}

{% block main %}
<div class="container mt-4">
    <h3 class="text-center mb-4">Order Details</h3>

    {% if session['role'] == "user" %}
        <div class="row text-center mb-3">
            <div class="col-6 text-end"><strong>Restaurant:</strong></div>
            <div class="col-6 text-start">{{ order.business_name }}</div>
        </div>
        <div class="row text-center mb-3">
            <div class="col-6 text-end"><strong>Phone:</strong></div>
            <div class="col-6 text-start">{{ order.business_phone }}</div>
        </div>
    {% else %}
        <div class="row text-center mb-3">
            <div class="col-6 text-end"><strong>User:</strong></div>
            <div class="col-6 text-start">{{ order.user_name }}</div>
        </div>
        <div class="row text-center mb-3">
            <div class="col-6 text-end"><strong>Phone:</strong></div>
            <div class="col-6 text-start">{{ order.user_phone }}</div>
        </div>
    {% endif %}

    <div class="row text-center mb-3">
        <div class="col-6 text-end"><strong>Order ID:</strong></div>
        <div class="col-6 text-start">{{ order.id }}</div>
    </div>

    <div class="row text-center mb-3">
        <div class="col-6 text-end"><strong>Created At:</strong></div>
        <div class="col-6 text-start">{{ order.date }}</div>
    </div>

    <div class="row text-center mb-4">
        <div class="col-6 text-end"><strong>Status:</strong></div>
        <div class="col-6 text-start">
            {% set status = order.status %}
            {% if status == "received" %}
                <span class="status-badge received">üì• Received</span>
            {% elif status == "preparing" %}
                <span class="status-badge preparing">üî™ Preparing</span>
            {% elif status == "onway" %}
                <span class="status-badge onway">üõµ On the Way</span>
            {% elif status == "completed" %}
                <span class="status-badge completed">üõçÔ∏è Completed</span>
            {% elif status == "canceled" %}
                <span class="status-badge canceled">‚ùå Canceled</span>
            {% else %}
                <span class="status-badge">{{ status }}</span>
            {% endif %}
        </div>
    </div>

    <div class="table-responsive">
        <table class="table table-striped table-bordered text-center align-middle">
            <thead class="table-light">
                <tr>
                    <th>Product</th>
                    <th>Quantity</th>
                    <th>Price</th>
                    <th>Subtotal</th>
                </tr>
            </thead>
            <tbody>
                {% for item in order_items %}
                <tr>
                    <td>{{ item.product_name }}</td>
                    <td>{{ item.quantity }}</td>
                    <td>{{ item.price }}</td>
                    <td>{{ item.subtotal }}</td>
                </tr>
                {% endfor %}
            </tbody>
            <tfoot class="table-light">
                <tr>
                    <td colspan="3" class="text-end"><strong>Total:</strong></td>
                    <td><strong>{{ order.total }}</strong></td>
                </tr>
                <tr>
                    <td colspan="4" class="text-center">
                        {% if session['role'] == 'user' %}
                            {% if not order.review %}
                                <form action="/leave-review" method="post" class="d-inline-block mt-2">
                                    <input type="hidden" name="order_id" value="{{ order.id }}">
                                    <button class="btn btn-primary px-4" type="submit">Leave a Review</button>
                                </form>
                            {% endif %}
                        {% else %}
                            {% if order.status not in ['completed', 'canceled'] %}
                            <form action="/update-status" method="post" class="d-inline-block mt-2">
                                    <input type="hidden" name="order_id" value="{{ order.id }}">
                                    <select name="status" class="form-select d-inline w-auto">
                                        <option disabled {% if order.status == "received" %}selected{% endif %} value="" >Received</option>
                                        <option value="preparing" {% if order.status == "preparing" %}selected{% endif %}>Preparing</option>
                                        <option value="onway" {% if order.status == "onway" %}selected{% endif %}>On the Way</option>
                                        <option value="completed" {% if order.status == "completed" %}selected{% endif %}>Completed</option>
                                        <option value="canceled" {% if order.status == "canceled" %}selected{% endif %}>Canceled</option>
                                </select>
                                    <button class="btn btn-outline-primary ms-2 px-4" type="submit">Update</button>
                                </form>
                            {% endif %}
                        {% endif %}
                    </td>
                </tr>
            </tfoot>
        </table>
    </div>
</div>
{% endblock %}
