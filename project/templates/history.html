{% extends "layout.html" %}

{% block title %}
    Order History
{% endblock %}

{% block head %}
    <style>
    .status-badge {
        font-weight: 600;
        font-size: 1rem;
        padding: 0.3rem 0.8rem;
        border-radius: 0.5rem;
        display: inline-flex;
        align-items: center;
        gap: 0.4rem;
    }

    .received {
        color: gray !important;
        background-color: #f0f0f0 !important;
    }

    .preparing {
        color: orange !important;
        background-color: #fff4e0 !important;
    }

    .onway {
        color: goldenrod !important;
        background-color: #fff8dc !important;
    }

    .completed {
        color: green !important;
        background-color: #e6ffea !important;
    }

    .canceled {
        color: red !important;
        background-color: #ffe6e6 !important;
        text-decoration: line-through red !important;
    }
    </style>

{% endblock %}

{% block main %}

    <div class="section">
         <table class="table table-striped table-hover align-middle text-center">

            <theads class="table-light">
                <tr>
                    <th>Ordered At</th>
                    {% if session["role"] == "business" %}
                        <th>Customer Name</th>
                    {% else %}
                        <th>Restaurant Name</th>
                    {% endif %}
                    <th>Total</th>
                    <th>Status</th>
                    <th> </th>
                    <th> </th>
                </tr>
            </theads>

            <tbody>

                {% if order_history %}
                    {% for order in order_history %}
                        <tr>
                            <td>{{ order.date }}</td>
                            {% if session["role"] == "business" %}
                                <td>{{ order.customer_name }}</td>
                            {% else %}
                                <td>{{ order.business_name }}</td>
                            {% endif %}
                            <td>{{ order.total }}</td>
                            <td>
                                {% set status = order.status %}
                                {% if status == "received" %}
                                    <span class="status-badge received">üì• Received</span>
                                {% elif status == "preparing" %}
                                    <span class="status-badge preparing">üî™ Preparing</span>
                                {% elif status == "onway" %}
                                    <span class="status-badge onway">üõµ On the Way</span>
                                {% elif status == "completed" %}
                                    <span class="status-badge completed">üõçÔ∏è Completed</span>
                                {% elif status == "canceled" %}
                                    <span class="status-badge canceled">‚ùå Canceled</span>
                                {% else %}
                                    <span class="status-badge">{{ status }}</span>
                                {% endif %}
                        </td>

                            <td>
                                <form action="/order-details" method="post">
                                    <input type="hidden" name="order_id" value="{{ order.id }}">
                                    <button class="btn btn-primary w-100" type="submit">View Details</button>
                                </form>
                            </td>
                            {% if session["role"] == "user" %}
                                {% if order.status == 'completed' or order.status == 'canceled' %}
                                    {% if not order.review %}
                                        <td>
                                            <form action="/leave-review" method="post">
                                                <input type="hidden" name="order_id" value="{{ order.id }}">
                                                <button class="btn btn-primary w-100" type="submit">Leave a Review</button>
                                            </form>
                                        </td>
                                    {% else %}
                                        <td></td>
                                    {% endif %}
                                {% else %}
                                    <td>
                                        <button class="btn btn-secondary w-100" type="button" disabled>Leave a Review</button>
                                    </td>
                                {% endif %}
                            {% endif %}
                        </tr>
                    {% endfor %}
                {% else %}
                    <tr>
                        <td colspan="4" class="text-center text-muted">You haven't order anything yet.</td>
                    </tr>
                {% endif %}
            </tbody>
        </table>
    </div>

{% endblock %}
